#include "sorcery.h"

#include <stdlib.h>
#include <string.h>
#include <stdio.h>

const char heads[5][8][8] = {
    { // Frown
        {32, 32, 213, 195, 195, 201, 32, 32},
        {32, 206, 32, 32, 32, 32, 205, 32},
        {213, 32, 150, 32, 32, 215, 32, 201},
        {221, 32, 32, 32, 32, 32, 32, 221},
        {221, 32, 175, 210, 210, 175, 32, 221},
        {202, 32, 32, 32, 32, 32, 32, 203},
        {32, 205, 32, 32, 32, 32, 206, 32},
        {32, 32, 202, 195, 195, 203, 32, 32}
    },
    { // Cat
        {32, 32, 32, 32, 32, 32, 32, 32},
        {32, 32, 32, 32, 32, 32, 32, 32},
        {32, 206, 205, 175, 175, 206, 205, 32},
        {32, 32, 32, 32, 32, 32, 32, 32},
        {183, 205, 209, 32, 32, 209, 206, 183},
        {195, 195, 32, 172, 187, 32, 195, 195},
        {175, 206, 202, 203, 202, 203, 205, 175},
        {32, 32, 32, 195, 195, 32, 32, 32}
    },
    { // Eyeball
        {32, 32, 32, 32, 32, 32, 32, 32},
        {32, 32, 32, 32, 32, 32, 32, 32},
        {32, 32, 32, 32, 32, 32, 32, 32},
        {32, 175, 195, 183, 183, 195, 175, 32},
        {206, 32, 206, 172, 187, 205, 32, 205},
        {205, 32, 205, 188, 190, 206, 32, 206},
        {32, 183, 195, 210, 210, 195, 183, 32},
        {32, 32, 32, 32, 32, 32, 32, 32}
    },
    { // Duck
        {32, 32, 32, 32, 32, 32, 32, 32},
        {32, 32, 213, 195, 195, 201, 32, 32},
        {32, 213, 32, 32, 32, 32, 201, 32},
        {32, 221, 209, 32, 32, 209, 221, 32},
        {32, 221, 175, 195, 195, 175, 221, 32},
        {32, 206, 32, 175, 175, 32, 205, 32},
        {32, 205, 183, 32, 32, 183, 206, 32},
        {32, 32, 183, 195, 195, 183, 32, 32}
    },
    { // corruption
        {32, 32, 44, 180, 27, 60, 32, 32},
        {32, 110, 0, 167, 227, 255, 114, 32},
        {33, 124, 57, 69, 246, 73, 128, 119},
        {228, 193, 180, 170, 104, 89, 29, 121},
        {61, 132, 162, 21, 2, 160, 96, 248},
        {89, 128, 185, 74, 157, 75, 68, 255},
        {32, 158, 29, 31, 114, 33, 243, 32},
        {32, 32, 247, 205, 254, 153, 32, 32}
    }
};

const char bodies[5][8][8] = {
    { // Ghostly
        {32, 32, 206, 32, 32, 205, 32, 32},
        {32, 206, 32, 32, 32, 32, 205, 32},
        {167, 32, 32, 32, 32, 32, 32, 165},
        {167, 32, 32, 32, 32, 32, 32, 165},
        {221, 32, 32, 32, 32, 32, 32, 221},
        {221, 32, 32, 32, 32, 32, 32, 221},
        {221, 213, 201, 213, 201, 213, 201, 221},
        {202, 203, 202, 203, 202, 203, 202, 203}
    }, 
    { // Mr.
        {32, 32, 206, 206, 205, 205, 32, 32},
        {32, 206, 32, 205, 206, 32, 205, 32},
        {206, 32, 32, 206, 205, 32, 32, 205},
        {165, 32, 32, 165, 167, 32, 32, 167},
        {165, 32, 32, 165, 167, 32, 32, 167},
        {165, 32, 32, 165, 167, 32, 32, 167},
        {165, 32, 32, 165, 167, 32, 32, 167},
        {165, 32, 32, 165, 167, 32, 32, 167}
    }, 
    { // Pillar.
        {32, 175, 175, 175, 175, 175, 175, 32},
        {32, 205, 205, 32, 32, 206, 206, 32},
        {32, 32, 165, 165, 167, 167, 32, 32},
        {32, 32, 165, 165, 167, 167, 32, 32},
        {32, 32, 165, 165, 167, 167, 32, 32},
        {32, 32, 165, 165, 167, 167, 32, 32},
        {32, 32, 165, 165, 167, 167, 32, 32},
        {32, 206, 206, 32, 32, 205, 205, 32}
    },
    { // Dr.
        {32, 32, 206, 205, 206, 205, 32, 32},
        {32, 206, 165, 167, 46, 167, 205, 32},
        {206, 206, 205, 167, 46, 167, 32, 205},
        {165, 165, 167, 167, 46, 167, 32, 167},
        {165, 165, 167, 167, 46, 213, 201, 167},
        {165, 209, 209, 167, 46, 202, 203, 167},
        {165, 32, 32, 167, 46, 32, 32, 167},
        {165, 32, 32, 167, 46, 32, 32, 167}
    },
    { // corruption
        {32, 32, 255, 165, 5, 49, 32, 32},
        {32, 161, 143, 96, 57, 82, 63, 32},
        {111, 162, 29, 211, 124, 203, 247, 174},
        {47, 166, 245, 31, 160, 250, 42, 181},
        {156, 215, 64, 20, 203, 128, 158, 95},
        {149, 175, 10, 58, 77, 240, 32, 156},
        {36, 99, 44, 54, 190, 77, 4, 202},
        {49, 92, 127, 186, 165, 162, 191, 154}
    }
};


void enemyBuild(Enemy *enemy, uint8 level) {
    
    enemy->headName = rand() % 5;
    enemy->bodyName = rand() % 5;;
    enemy->adjective = rand() % 5;

    enemy->head = &heads[enemy->headName];
    enemy->body = &bodies[enemy->bodyName];

    enemy->stats.level = level;

    enemy->stats.experience = 0;

    enemy->stats.health.health = 10 * level;
    enemy->stats.health.maxHealth = 10 * level;

    enemy->stats.attack = ((rand() % 3 + 1)*level);
    enemy->stats.defense = ((rand() % 3 + 1)*level);
    enemy->stats.speed = ((rand() % 3 + 1)*level);
    enemy->stats.luck = ((rand() % 3 + 1)*level);
}

void enemyAttack(Context *ctx, bool playerDefending) { 
    // A defening player uses their full defense stat
    int8 damage = playerDefending ? ctx->enemy.stats.attack - ctx->player.stats.defense : ctx->enemy.stats.attack - ctx->player.stats.defense/2;
    char *message;
    // bounding check
    damage = damage < 0 ? 0 : damage;

    message = malloc(sizeof(char) * (strlen(locale[ctx->locale][LC_COMBAT_ENEMY_ATTACK]) + damage%10 + 1));
    sprintf(message, locale[ctx->locale][LC_COMBAT_ENEMY_ATTACK], damage);

    consoleBufferAdd(&ctx->consoleBuffer, message);
    free(message);

    if (damage < 0)
        damage = 0;
    ctx->player.stats.health.health -= damage;
}
